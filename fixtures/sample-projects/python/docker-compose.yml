version: '3.8'
services:
  generate:
    build: .
    volumes:
      - ../../generated/python:/output
    command: /bin/sh -c "
      echo 'Running pytest (JSON)...' &&
      pytest -v --json-report --json-report-file=/output/pytest-results.json 2>/dev/null || true &&
      echo 'Running pytest (HTML)...' &&
      pytest -v --html=/output/pytest-report.html --self-contained-html 2>/dev/null || true &&
      echo 'Running ruff...' &&
      ruff check src/ 2>&1 > /output/ruff-output.txt || true &&
      echo 'Running mypy (text)...' &&
      mypy src/ 2>&1 > /output/mypy-output.txt || true &&
      echo 'Running mypy (JSON)...' &&
      mypy src/ --output json 2>/dev/null > /output/mypy-results.json || true &&
      echo 'Python artifact generation complete!'
      "
